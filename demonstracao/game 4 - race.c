#include "poly/poly.h"
#include <math.h>
int fatorx[36]={9,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8};
int fatory[36]={0,-1,-2,-3,-4,-5,-6,-7,-8,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,8,7,6,5,4,3,2,1};
int pista[17][23]={{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0},{0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0},{0,0,0,0,4,4,4,4,4,4,2,0,4,4,4,4,4,4,1,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,2,3,3,3,3,0,1,3,3,3,3,0,0,0,0,0,0},{0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0},{0,0,0,0,0,0,4,4,4,4,2,0,4,4,4,4,1,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,2,3,3,0,1,3,3,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,2,0,0,0,0,0,1,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,4,4,2,0,4,4,1,0,0,0,0,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0},{0,0,0,0,2,3,3,3,3,3,3,0,1,3,3,3,3,3,3,0,0,0,0},{0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0},{0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,0,0,0,0},{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}};
int px,py,angulo;

void init(){
	px=1320;
	py=1136;
	angulo=0;
}

int main(){
	
	init();
	setvideomode();
	while(!keystate(KEY_ESCAPE)){
		setcolor(0);
		bar(0,0,320,200);
		//for(int x=0;x<17;x++)for(int y=0;y<23;y++)if(pista[x][y]!=0)bar(24+(12*y),0+(12*x),11,11);
		
		setcolor(1);
		for(int x=0;x<17;x++)for(int y=0;y<23;y++)if(pista[x][y]!=0)
			bar(-px+(80*y),-py+(80*x),80,80);

		setcolor(2);
		fillcircle(160,100,14);
		
		int borda=((angulo+18)%36)*10;
		setcolor(4);
		fillcircle(160+(sin(borda*0.0174)*14),100+(cos(borda*0.0174)*14),4);

		if(keystate(KEY_LEFT))angulo=(angulo+1)%36;
		if(keystate(KEY_RIGHT))angulo=(angulo+35)%36;

		int lx=((py+20)/80)+1;
		int ly=(px/80)+2;

		if(lx>=0&&ly>=0&&lx<17&&ly<23&&pista[lx][ly]!=0){
			py-=fatorx[angulo];
			px+=fatory[angulo];
		}
		else init();

		sleep(29);

		waitvbl();
	}
	return 0;
}
